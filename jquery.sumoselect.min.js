/*
 * jquery.sumoselect - v3.0.2
 * http://hemantnegi.github.io/jquery.sumoselect
 * 2014-04-08
 *
 * Copyright 2015 Hemant Negi
 * Email : hemant.frnz@gmail.com
 * Compressor http://refresh-sf.com/
 */
(function(a){a.fn.SumoSelect=function(d){var b={placeholder:"Select Here",csvDispCount:3,captionFormat:"{0} Selected",captionFormatAllSelected:"{0} all selected!",floatWidth:400,forceCustomRendering:false,nativeOnDevice:["Android","BlackBerry","iPhone","iPad","iPod","Opera Mini","IEMobile","Silk"],outputAsCSV:false,csvSepChar:",",okCancelInMulti:false,triggerChangeCombined:true,selectAll:false,search:false,searchText:"Search...",noMatch:'No matches for "{0}"',prefix:"",locale:["OK","Cancel","Select All"],up:false};var c=this.each(function(){var e=a.extend({},b,d);var f=this;if(this.sumo||!a(this).is("select")){return}this.sumo={E:a(f),is_multi:a(f).attr("multiple"),select:"",caption:"",placeholder:"",optDiv:"",CaptionCont:"",ul:"",is_floating:false,is_opened:false,mob:false,Pstate:[],createElems:function(){var g=this;g.E.wrap('<div class="SumoSelect" tabindex="0">');g.select=g.E.parent();g.caption=a("<span>");g.CaptionCont=a('<p class="CaptionCont"><label><i></i></label></p>').addClass("SelectBox").attr("style",g.E.attr("style")).prepend(g.caption);g.select.append(g.CaptionCont);if(!g.is_multi){e.okCancelInMulti=false}if(g.E.attr("disabled")){g.select.addClass("disabled").removeAttr("tabindex")}if(e.outputAsCSV&&g.is_multi&&g.E.attr("name")){g.select.append(a('<input class="HEMANT123" type="hidden" />').attr("name",g.E.attr("name")).val(g.getSelStr()));g.E.removeAttr("name")}if(g.isMobile()&&!e.forceCustomRendering){g.setNativeMobile();return}if(g.E.attr("name")){g.select.addClass("sumo_"+g.E.attr("name"))}g.E.addClass("SumoUnder").attr("tabindex","-1");g.optDiv=a('<div class="optWrapper '+(e.up?"up":"")+'">');g.floatingList();g.ul=a('<ul class="options">');g.optDiv.append(g.ul);if(e.selectAll){g.SelAll()}if(e.search){g.Search()}g.ul.append(g.prepItems(g.E.children()));if(g.is_multi){g.multiSelelect()}g.select.append(g.optDiv);g.basicEvents();g.selAllState()},prepItems:function(h,k){var g=[],j=this;a(h).each(function(m,l){l=a(l);g.push(l.is("optgroup")?a('<li class="group '+(l[0].disabled?"disabled":"")+'"><label>'+l.attr("label")+"</label><ul></ul><li>").find("ul").append(j.prepItems(l.children(),l[0].disabled)).end():j.createLi(l,k))});return g},createLi:function(g,j){var h=this;if(!g.attr("value")){g.attr("value",g.val())}li=a('<li class="opt"><label>'+g.text()+"</label></li>");li.data("opt",g);g.data("li",li);if(h.is_multi){li.prepend("<span><i></i></span>")}if(g[0].disabled||j){li=li.addClass("disabled")}h.onOptClick(li);if(g[0].selected){li.addClass("selected")}if(g.attr("class")){li.addClass(g.attr("class"))}return li},getSelStr:function(){sopt=[];this.E.find("option:selected").each(function(){sopt.push(a(this).val())});return sopt.join(e.csvSepChar)},multiSelelect:function(){var g=this;g.optDiv.addClass("multiple");g.okbtn=a('<p class="btnOk">'+e.locale[0]+"</p>").click(function(){if(e.triggerChangeCombined){changed=false;if(g.E.find("option:selected").length!=g.Pstate.length){changed=true}else{g.E.find("option").each(function(h,j){if(j.selected&&g.Pstate.indexOf(h)<0){changed=true}})}if(changed){g.callChange();g.setText()}}g.hideOpts()});g.cancelBtn=a('<p class="btnCancel">'+e.locale[1]+"</p>").click(function(){g._cnbtn();g.hideOpts()});g.optDiv.append(a('<div class="MultiControls">').append(g.okbtn).append(g.cancelBtn))},_cnbtn:function(){var h=this;h.E.find("option:selected").each(function(){this.selected=false});h.optDiv.find("li.selected").removeClass("selected");for(var g=0;g<h.Pstate.length;g++){h.E.find("option")[h.Pstate[g]].selected=true;h.ul.find("li.opt").eq(h.Pstate[g]).addClass("selected")}h.selAllState()},SelAll:function(){var g=this;if(!g.is_multi){return}g.selAll=a('<p class="select-all"><span><i></i></span><label>'+e.locale[2]+"</label></p>");g.selAll.on("click",function(){g.selAll.toggleClass("selected");g.optDiv.find("li.opt").not(".hidden").each(function(h,j){j=a(j);if(g.selAll.hasClass("selected")){if(!j.hasClass("selected")){j.trigger("click")}}else{if(j.hasClass("selected")){j.trigger("click")}}})});g.optDiv.prepend(g.selAll)},Search:function(){var h=this,j=h.CaptionCont.addClass("search"),g=a('<p class="no-match">');h.ftxt=a('<input type="text" class="search-txt" value="" placeholder="'+e.searchText+'">').on("click",function(k){k.stopPropagation()});j.append(h.ftxt);h.optDiv.children("ul").after(g);h.ftxt.on("keyup.sumo",function(){var k=h.optDiv.find("ul.options li.opt").each(function(l,m){m=a(m);if(m.text().toLowerCase().indexOf(h.ftxt.val().toLowerCase())>-1){m.removeClass("hidden")}else{m.addClass("hidden")}}).not(".hidden");g.html(e.noMatch.replace(/\{0\}/g,h.ftxt.val())).toggle(!k.length);h.selAllState()})},selAllState:function(){var h=this;if(e.selectAll){var j=0,g=0;h.optDiv.find("li.opt").not(".hidden").each(function(k,l){if(a(l).hasClass("selected")){j++}if(!a(l).hasClass("disabled")){g++}});if(j==g){h.selAll.removeClass("partial").addClass("selected")}else{if(j==0){h.selAll.removeClass("selected partial")}else{h.selAll.addClass("partial")}}}},showOpts:function(){var g=this;if(g.E.attr("disabled")){return}g.is_opened=true;g.select.addClass("open");if(g.ftxt){g.ftxt.focus()}else{g.select.focus()}a(document).on("click.sumo",function(h){if(!g.select.is(h.target)&&g.select.has(h.target).length===0){if(!g.is_opened){return}g.hideOpts();if(e.okCancelInMulti){g._cnbtn()}}});if(g.is_floating){H=g.optDiv.children("ul").outerHeight()+2;if(g.is_multi){H=H+parseInt(g.optDiv.css("padding-bottom"))}g.optDiv.css("height",H);a("body").addClass("sumoStopScroll")}g.setPstate()},setPstate:function(){var g=this;if(g.is_multi&&(g.is_floating||e.okCancelInMulti)){g.Pstate=[];g.E.find("option").each(function(h,j){if(j.selected){g.Pstate.push(h)}})}},callChange:function(){this.E.trigger("change").trigger("click")},hideOpts:function(){var g=this;if(g.is_opened){g.is_opened=false;g.select.removeClass("open").find("ul li.sel").removeClass("sel");a(document).off("click.sumo");g.select.focus();a("body").removeClass("sumoStopScroll");if(e.search){g.ftxt.val("");g.optDiv.find("ul.options li").removeClass("hidden");g.optDiv.find(".no-match").toggle(false)}}},setOnOpen:function(){var h=this,g=h.optDiv.find("li.opt:not(.hidden)").eq(e.search?0:h.E[0].selectedIndex);h.optDiv.find("li.sel").removeClass("sel");g.addClass("sel");h.showOpts()},nav:function(h){var j=this,l,p=j.ul.find("li.opt:not(.disabled, .hidden)"),g=j.ul.find("li.opt.sel:not(.hidden)"),m=p.index(g);if(j.is_opened&&g.length){if(h&&m>0){l=p.eq(m-1)}else{if(!h&&m<p.length-1&&m>-1){l=p.eq(m+1)}else{return}}g.removeClass("sel");g=l.addClass("sel");var k=j.ul,o=k.scrollTop(),n=g.position().top+o;if(n>=o+k.height()-g.outerHeight()){k.scrollTop(n-k.height()+g.outerHeight())}if(n<o){k.scrollTop(n)}}else{j.setOnOpen()}},basicEvents:function(){var g=this;g.CaptionCont.click(function(h){g.E.trigger("click");if(g.is_opened){g.hideOpts()}else{g.showOpts()}h.stopPropagation()});g.select.on("keydown.sumo",function(h){switch(h.which){case 38:g.nav(true);break;case 40:g.nav(false);break;case 32:if(e.search&&g.ftxt.is(h.target)){return}case 13:if(g.is_opened){g.optDiv.find("ul li.sel").trigger("click")}else{g.setOnOpen()}break;case 9:case 27:if(e.okCancelInMulti){g._cnbtn()}g.hideOpts();return;default:return}h.preventDefault()});a(window).on("resize.sumo",function(){g.floatingList()})},onOptClick:function(g){var h=this;g.click(function(){var j=a(this);if(j.hasClass("disabled")){return}txt="";if(h.is_multi){j.toggleClass("selected");j.data("opt")[0].selected=j.hasClass("selected");h.selAllState()}else{j.parent().find("li.selected").removeClass("selected");j.toggleClass("selected");j.data("opt")[0].selected=true}if(!(h.is_multi&&e.triggerChangeCombined&&(h.is_floating||e.okCancelInMulti))){h.setText();h.callChange()}if(!h.is_multi){h.hideOpts()}})},setText:function(){var g=this;g.placeholder="";if(g.is_multi){sels=g.E.find(":selected").not(":disabled");for(i=0;i<sels.length;i++){if(i+1>=e.csvDispCount&&e.csvDispCount){if(sels.length==g.E.find("option").length&&e.captionFormatAllSelected){g.placeholder=e.captionFormatAllSelected.replace(/\{0\}/g,sels.length)+","}else{g.placeholder=e.captionFormat.replace(/\{0\}/g,sels.length)+","}break}else{g.placeholder+=a(sels[i]).text()+", "}}g.placeholder=g.placeholder.replace(/,([^,]*)$/,"$1")}else{g.placeholder=g.E.find(":selected").not(":disabled").text()}is_placeholder=false;if(!g.placeholder){is_placeholder=true;g.placeholder=g.E.attr("placeholder");if(!g.placeholder){g.placeholder=g.E.find("option:disabled:selected").text()}}g.placeholder=g.placeholder?(e.prefix+" "+g.placeholder):e.placeholder;g.caption.html(g.placeholder);g.CaptionCont.attr("title",g.placeholder);csvField=g.select.find("input.HEMANT123");if(csvField.length){csvField.val(g.getSelStr())}if(is_placeholder){g.caption.addClass("placeholder")}else{g.caption.removeClass("placeholder")}return g.placeholder},isMobile:function(){var h=navigator.userAgent||navigator.vendor||window.opera;for(var g=0;g<e.nativeOnDevice.length;g++){if(h.toString().toLowerCase().indexOf(e.nativeOnDevice[g].toLowerCase())>0){return e.nativeOnDevice[g]}}return false},setNativeMobile:function(){var g=this;g.E.addClass("SelectClass");g.mob=true;g.E.change(function(){g.setText()})},floatingList:function(){var g=this;g.is_floating=a(window).width()<=e.floatWidth;g.optDiv.toggleClass("isFloating",g.is_floating);if(!g.is_floating){g.optDiv.css("height","")}g.optDiv.toggleClass("okCancelInMulti",e.okCancelInMulti&&!g.is_floating)},vRange:function(g){var h=this;opts=h.E.find("option");if(opts.length<=g||g<0){throw"index out of bounds"}return h},toggSel:function(j,g){var h=this;if(typeof(g)==="number"){h.vRange(g);opt=h.E.find("option")[g]}else{opt=h.E.find('option[value="'+g+'"]')[0]||0}if(!opt||opt.disabled){return}if(opt.selected!=j){opt.selected=j;if(!h.mob){a(opt).data("li").toggleClass("selected",j)}h.callChange();h.setPstate();h.setText();h.selAllState()}},toggDis:function(j,g){var h=this.vRange(g);h.E.find("option")[g].disabled=j;if(j){h.E.find("option")[g].selected=false}if(!h.mob){h.optDiv.find("ul.options li").eq(g).toggleClass("disabled",j).removeClass("selected")}h.setText()},toggSumo:function(h){var g=this;g.enabled=h;g.select.toggleClass("disabled",h);if(h){g.E.attr("disabled","disabled");g.select.removeAttr("tabindex")}else{g.E.removeAttr("disabled");g.select.attr("tabindex","0")}return g},toggSelAll:function(h){var g=this;g.E.find("option").each(function(j,k){if(g.E.find("option")[a(this).index()].disabled){return}g.E.find("option")[a(this).index()].selected=h;if(!g.mob){g.optDiv.find("ul.options li").eq(a(this).index()).toggleClass("selected",h)}g.setText()});if(!g.mob&&g.selAll){g.selAll.removeClass("partial").toggleClass("selected",h)}g.callChange();g.setPstate()},reload:function(){var g=this.unload();return a(g).SumoSelect(e)},unload:function(){var g=this;g.select.before(g.E);g.E.show();if(e.outputAsCSV&&g.is_multi&&g.select.find("input.HEMANT123").length){g.E.attr("name",g.select.find("input.HEMANT123").attr("name"))}g.select.remove();delete f.sumo;return f},add:function(k,g,h){if(typeof k=="undefined"){throw"No value to add"}var j=this;opts=j.E.find("option");if(typeof g=="number"){h=g;g=k}if(typeof g=="undefined"){g=k}opt=a("<option></option>").val(k).html(g);if(opts.length<h){throw"index out of bounds"}if(typeof h=="undefined"||opts.length==h){j.E.append(opt);if(!j.mob){j.ul.append(j.createLi(opt))}}else{opts.eq(h).before(opt);if(!j.mob){j.ul.find("li.opt").eq(h).before(j.createLi(opt))}}return f},remove:function(g){var h=this.vRange(g);h.E.find("option").eq(g).remove();if(!h.mob){h.optDiv.find("ul.options li").eq(g).remove()}h.setText()},selectItem:function(g){this.toggSel(true,g)},unSelectItem:function(g){this.toggSel(false,g)},selectAll:function(){this.toggSelAll(true)},unSelectAll:function(){this.toggSelAll(false)},disableItem:function(g){this.toggDis(true,g)},enableItem:function(g){this.toggDis(false,g)},enabled:true,enable:function(){return this.toggSumo(false)},disable:function(){return this.toggSumo(true)},init:function(){var g=this;g.createElems();g.setText();return g}};f.sumo.init()});return c.length==1?c[0]:c}}(jQuery));